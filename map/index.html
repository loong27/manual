<style>
:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
    color: {$diyitem['style']['searchtextcolor']}; opacity:1; 
}

::-moz-placeholder { /* Mozilla Firefox 19+ */
    color: {$diyitem['style']['searchtextcolor']};opacity:1;
}

input:-ms-input-placeholder{
    color: {$diyitem['style']['searchtextcolor']};opacity:1;
}

input::-webkit-input-placeholder{
    color: {$diyitem['style']['searchtextcolor']};opacity:1;
}
.location{
    width:40%;
    height: 28px;
    border: 0;
    border-radius:5px;
    padding: 0 6px;
    font-size: 14px;
    line-height: 29px;
    color: {$diyitem['style']['searchtextcolor']};opacity: {$diyitem['style']['opacity']};
    background: {$diyitem['style']['searchbackground']};
}
.location p{
    width:23px;
    height:30px;
    float:left;
    background: url(/index/sce1.png);
    background-size:cover;
}

</style>
<script src="/app/resource/js/lib/jquery-1.11.1.min.js"></script> 
    <div class="diy-fixedsearch fixed">
        <div class="background"></div>
        <form action="" method="post" class="inner">
            <div class="location">
                <p>&nbsp;</p>
                <span id="addre">获取定位中...</span>
            </div>
            <div class="center sce2">
                <input type="hidden" id="lat" name="">
                <input type="hidden" id="lng" name="">
            </div>
        </form>
    </div>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.3"></script>  
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=hNGh7Ijv4ed9ztF6nUzsbt7sG94hHDSg"></script>
    <script type="text/javascript">
        var geolocation = new BMap.Geolocation();  
        geolocation.getCurrentPosition(function(r) {  
            if (this.getStatus() == BMAP_STATUS_SUCCESS) {  
                var mk = new BMap.Marker(r.point);
                document.getElementById("lat").value = r.point.lat;
                document.getElementById("lng").value = r.point.lng;
                var myGeo = new BMap.Geocoder();  
                myGeo.getLocation(new BMap.Point(r.point.lng, r.point.lat),           
                        function(rs) {  
                            var addComp = rs.addressComponents;
                            /*$("#addre").html(addComp.district + addComp.street  
                                    + addComp.streetNumber);*/
                        });  
  
            } else {  
                alert('failed' + this.getStatus());  
            }  
        });
        
        $(function(){
            $(document).ready(function(){
                setTimeout(function(){
                    var latv = $("#lat").val();
                    var lngv = $("#lng").val();
                    $.ajax({
                        url:'/app/index.php?i=89&c=entry&m=ewei_shopv2&do=mobile&r=test2',
                        type:'post',
                        dataType:'json',
                        data:{lat:latv,lng:lngv},
                        success:function(data){
                            var str = eval('('+data+')');
                            $("#addre").html(str.result.formatted_address);
                        },
                        error : function() {
                            document.getElementById("addre").value = "获取定位失败";
                        }
                    });
                    },2000); 
            });
        });
    </script>